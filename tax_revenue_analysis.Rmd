---
title: "Cook County Property Tax Revenue Analysis"
author: "Cook County Potential"
date: "`r format(Sys.time(), '%B %d, %Y')`"
output: 
  github_document:
    toc: true
    toc_depth: 3
    fig_width: 10
    fig_height: 6
always_allow_html: true
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, warning = FALSE, message = FALSE)

# Load all required packages upfront
if (!require("tidyverse")) install.packages("tidyverse")
if (!require("knitr")) install.packages("knitr")
if (!require("scales")) install.packages("scales")
if (!require("ggplot2")) install.packages("ggplot2")

library(tidyverse)
library(knitr)
library(scales)
library(ggplot2)

# Helper functions for formatting
format_currency <- function(x) {
  scales::dollar(x, accuracy = 1)
}

format_number <- function(x) {
  scales::comma(x, accuracy = 1)
}

format_percent <- function(x) {
  scales::percent(x/100, accuracy = 0.1)
}

# Modern color palette
modern_palette <- c("#2E86AB", "#A23B72", "#F18F01", "#C73E1D", "#3B1F2B")
```

## Introduction

This analysis explores the potential property tax revenue that could be generated through new housing development in Cook County, with a focus on Chicago townships. Using actual property tax data from 2021-2022, we model various scenarios for housing development and their impact on tax revenue.

## Current Property Tax Landscape

First, let's examine the current property tax situation across different housing types and locations.

```{r load_data}
# Load the data
summary_data <- read.csv("property_tax_summary.csv")
bedroom_data <- read.csv("property_tax_by_bedroom.csv")
township_data <- read.csv("property_tax_by_township.csv")

# Filter for most recent year (2022)
current_summary <- summary_data %>%
  filter(year == 2022) %>%
  select(property_type, avg_tax_per_unit, avg_value_per_unit, effective_tax_rate) %>%
  # Handle NA values in effective tax rate
  mutate(effective_tax_rate = ifelse(is.na(effective_tax_rate), 
                                    avg_tax_per_unit / avg_value_per_unit * 100,
                                    effective_tax_rate))

# Create summary table
kable(current_summary %>%
  mutate(
    avg_tax_per_unit = format_currency(avg_tax_per_unit),
    avg_value_per_unit = format_currency(avg_value_per_unit),
    effective_tax_rate = format_percent(effective_tax_rate)
  ),
  col.names = c("Property Type", "Avg Tax/Unit", "Avg Value/Unit", "Effective Tax Rate"),
  caption = "2022 Property Tax Summary by Housing Type")
```

### Geographic Distribution

Let's examine how property taxes vary across Chicago townships.

```{r township_analysis, fig.height=8}
# Create township visualization with improved styling
township_plot <- township_data %>%
  filter(year == 2022) %>%
  ggplot(aes(x = reorder(township, avg_tax_per_unit), 
             y = avg_tax_per_unit, 
             fill = property_type)) +
  geom_bar(stat = "identity", 
           position = position_dodge(width = 0.9)) +
  geom_text(aes(label = scales::dollar(avg_tax_per_unit, accuracy = 1)),
            position = position_dodge(width = 0.9),
            hjust = -0.1,
            size = 3) +
  coord_flip() +
  scale_y_continuous(labels = scales::dollar_format(),
                    expand = expansion(mult = c(0, 0.2))) +
  scale_fill_manual(values = modern_palette) +
  labs(
    title = "Average Property Tax per Unit by Township and Property Type (2022)",
    subtitle = "Data labels show average tax amount per unit",
    x = "Township",
    y = "Average Tax per Unit",
    fill = "Property Type"
  ) +
  theme_minimal() +
  theme(
    plot.title = element_text(face = "bold", size = 14),
    plot.subtitle = element_text(size = 10, color = "gray50"),
    axis.title = element_text(face = "bold"),
    legend.position = "bottom",
    legend.box = "horizontal",
    panel.grid.major.y = element_blank()
  )

township_plot
```

### Unit Size Analysis

Different unit sizes have varying tax implications:

```{r bedroom_analysis, fig.height=7}
# Create bedroom analysis visualization with improved styling
bedroom_plot <- bedroom_data %>%
  filter(year == 2022) %>%
  ggplot(aes(x = bedroom_type, 
             y = avg_tax_per_unit, 
             fill = property_type)) +
  geom_bar(stat = "identity", 
           position = position_dodge(width = 0.9)) +
  geom_text(aes(label = scales::dollar(avg_tax_per_unit, accuracy = 1)),
            position = position_dodge(width = 0.9),
            vjust = -0.5,
            size = 3) +
  scale_y_continuous(labels = scales::dollar_format(),
                    expand = expansion(mult = c(0, 0.2))) +
  scale_fill_manual(values = modern_palette) +
  labs(
    title = "Average Property Tax by Unit Size and Property Type (2022)",
    subtitle = "Data labels show average tax amount per unit",
    x = "Unit Type",
    y = "Average Tax per Unit",
    fill = "Property Type"
  ) +
  theme_minimal() +
  theme(
    plot.title = element_text(face = "bold", size = 14),
    plot.subtitle = element_text(size = 10, color = "gray50"),
    axis.title = element_text(face = "bold"),
    axis.text.x = element_text(angle = 45, hjust = 1),
    legend.position = "bottom",
    legend.box = "horizontal",
    panel.grid.major.x = element_blank()
  ) +
  scale_x_discrete(labels = function(x) {
    gsub("_", " ", str_to_title(x))
  })

bedroom_plot
```

## Development Scenarios

Let's model different scenarios for new housing development and their potential tax revenue impact. Each scenario is carefully designed based on different development priorities and market conditions:

### 1. Balanced Growth Scenario
This scenario aims to provide a diverse mix of housing types while maintaining neighborhood character:
- **1,000 1-bed condos**: Entry-level housing for young professionals and small households
- **1,000 2-bed condos**: Family-friendly units in medium-density areas
- **500 single-family homes**: Preserving some traditional housing stock
- **2,000 large multi-family units**: Mix of studio to 3-bed units in larger developments
- **1,500 small multi-family units**: 2-6 unit buildings spread throughout neighborhoods

*Rationale*: This mix provides housing options across all income levels and household sizes while maintaining a balance between density and neighborhood character. The larger proportion of multi-family units (3,500 total) reflects the need for density, while the equal split between 1-bed and 2-bed condos (2,000 total) caters to both singles and small families.

### 2. Transit-Oriented Development (TOD) Scenario
Focused on high-density development near transit hubs:
- **2,000 1-bed condos**: Higher concentration of smaller units near transit
- **1,500 2-bed condos**: Family units with good transit access
- **3,000 large multi-family units**: Major developments near transit stations
- **1,000 small multi-family units**: Moderate density in transit corridors
- **200 single-family homes**: Limited to areas farther from transit

*Rationale*: This scenario prioritizes density near transit with 75% of units (6,500) being multi-family or condo. The higher number of 1-bed condos (2,000) versus 2-bed (1,500) reflects typical TOD resident demographics. The reduced single-family component (200 units) emphasizes the transit-oriented nature of the development.

### 3. Affordable Housing Focus Scenario
Prioritizes accessible housing options across different household sizes:
- **1,500 1-bed condos**: Affordable entry-level housing
- **500 2-bed condos**: Family-sized units at moderate price points
- **4,000 large multi-family units**: Maximum density for affordability
- **2,000 small multi-family units**: Distributed affordable housing
- **100 single-family homes**: Minimal single-family development

*Rationale*: This scenario maximizes affordable units through higher density, with 6,000 multi-family units (75% of total). The emphasis on 1-bed over 2-bed condos (3:1 ratio) prioritizes entry-level housing, while the minimal single-family component (100 units) reflects the focus on affordability through density.

```{r scenario_planning}
# Get average tax rates by property and bedroom type for 2022
tax_rates <- bedroom_data %>%
  filter(year == 2022) %>%
  select(property_type, bedroom_type, avg_tax_per_unit)

# Define scenarios
scenarios <- tribble(
  ~scenario_name, ~property_type, ~bedroom_type, ~units,
  # Balanced Growth
  "Balanced Growth", "Condo", "beds_1", 1000,
  "Balanced Growth", "Condo", "beds_2", 1000,
  "Balanced Growth", "Single Family", "beds_3plus", 500,
  "Balanced Growth", "Large Multi-Family (7+ units)", "mixed_studio_to_3", 2000,
  "Balanced Growth", "Small Multi-Family (2-6 units)", "mixed_1_to_3", 1500,
  
  # Transit-Oriented Development
  "TOD", "Condo", "beds_1", 2000,
  "TOD", "Condo", "beds_2", 1500,
  "TOD", "Large Multi-Family (7+ units)", "mixed_studio_to_3", 3000,
  "TOD", "Small Multi-Family (2-6 units)", "mixed_1_to_3", 1000,
  "TOD", "Single Family", "beds_3plus", 200,
  
  # Affordable Housing Focus
  "Affordable Housing", "Condo", "beds_1", 1500,
  "Affordable Housing", "Large Multi-Family (7+ units)", "mixed_studio_to_3", 4000,
  "Affordable Housing", "Small Multi-Family (2-6 units)", "mixed_1_to_3", 2000,
  "Affordable Housing", "Condo", "beds_2", 500,
  "Affordable Housing", "Single Family", "beds_3plus", 100
)

# Calculate revenue for each scenario
scenario_results <- scenarios %>%
  left_join(tax_rates, by = c("property_type", "bedroom_type")) %>%
  mutate(tax_revenue = units * avg_tax_per_unit)

# Summarize results
scenario_summary <- scenario_results %>%
  group_by(scenario_name) %>%
  summarize(
    total_units = sum(units),
    total_revenue = sum(tax_revenue),
    revenue_per_unit = total_revenue / total_units
  )

# Display summary table
kable(scenario_summary %>%
  mutate(
    total_units = format_number(total_units),
    total_revenue = format_currency(total_revenue),
    revenue_per_unit = format_currency(revenue_per_unit)
  ),
  col.names = c("Scenario", "Total Units", "Annual Tax Revenue", "Revenue per Unit"),
  caption = "Projected Annual Tax Revenue by Development Scenario")

# Create improved scenario visualization
scenario_plot <- scenario_results %>%
  group_by(scenario_name, property_type) %>%
  summarize(tax_revenue = sum(tax_revenue), .groups = 'drop') %>%
  ggplot(aes(x = scenario_name, 
             y = tax_revenue/1e6, 
             fill = property_type)) +
  geom_bar(stat = "identity", position = "stack") +
  geom_text(aes(label = scales::dollar(tax_revenue/1e6, accuracy = 0.1, suffix = "M")),
            position = position_stack(vjust = 0.5),
            color = "white",
            size = 3) +
  scale_y_continuous(labels = scales::dollar_format(suffix = "M"),
                    expand = expansion(mult = c(0, 0.1))) +
  scale_fill_manual(values = modern_palette) +
  labs(
    title = "Projected Annual Tax Revenue by Development Scenario",
    subtitle = "Broken down by property type, with revenue amounts shown in millions",
    x = "Development Scenario",
    y = "Tax Revenue (Millions)",
    fill = "Property Type"
  ) +
  theme_minimal() +
  theme(
    plot.title = element_text(face = "bold", size = 14),
    plot.subtitle = element_text(size = 10, color = "gray50"),
    axis.title = element_text(face = "bold"),
    axis.text.x = element_text(angle = 45, hjust = 1),
    legend.position = "bottom",
    legend.box = "horizontal",
    panel.grid.major.x = element_blank()
  )

scenario_plot
```

## Case Study: Lake View Township Development Potential

To better understand the specific impact of new housing development in different areas, let's examine Lake View township as a detailed case study.

```{r lakeview_current}
# Filter data for Lake View township and calculate effective tax rate
lakeview_data <- township_data %>%
  filter(year == 2022, township == "LAKE VIEW") %>%
  arrange(desc(avg_tax_per_unit)) %>%
  # Calculate effective tax rate
  mutate(effective_tax_rate = (avg_tax_per_unit / avg_value_per_unit) * 100)

# Create summary table for Lake View
kable(lakeview_data %>%
  select(year, township, property_type, avg_tax_per_unit, avg_value_per_unit, effective_tax_rate) %>%
  mutate(
    avg_tax_per_unit = format_currency(avg_tax_per_unit),
    avg_value_per_unit = format_currency(avg_value_per_unit),
    effective_tax_rate = format_percent(effective_tax_rate)
  ),
  col.names = c("Year", "Township", "Property Type", "Avg Tax/Unit", "Avg Value/Unit", "Effective Tax Rate"),
  caption = "Current Property Tax Metrics in Lake View Township (2022)")

# Calculate township-specific metrics using raw numbers before formatting
lakeview_metrics <- lakeview_data %>%
  summarize(
    avg_tax_all_types = mean(avg_tax_per_unit),
    max_tax = max(avg_tax_per_unit),
    min_tax = min(avg_tax_per_unit)
  )
```

### Lake View Development Scenarios

Based on Lake View's current property tax patterns and development characteristics, we'll model three targeted scenarios:

```{r lakeview_scenarios}
# Define Lake View specific scenarios
lakeview_scenarios <- tribble(
  ~scenario_name, ~property_type, ~bedroom_type, ~units,
  # High-Density Transit Corridor
  "Transit Corridor", "Large Multi-Family (7+ units)", "mixed_studio_to_3", 1500,
  "Transit Corridor", "Condo", "beds_1", 800,
  "Transit Corridor", "Condo", "beds_2", 500,
  "Transit Corridor", "Small Multi-Family (2-6 units)", "mixed_1_to_3", 200,
  
  # Mixed-Income Development
  "Mixed-Income", "Large Multi-Family (7+ units)", "mixed_studio_to_3", 1000,
  "Mixed-Income", "Small Multi-Family (2-6 units)", "mixed_1_to_3", 500,
  "Mixed-Income", "Condo", "beds_1", 400,
  "Mixed-Income", "Condo", "beds_2", 300,
  
  # Neighborhood Infill
  "Neighborhood Infill", "Small Multi-Family (2-6 units)", "mixed_1_to_3", 800,
  "Neighborhood Infill", "Condo", "beds_2", 400,
  "Neighborhood Infill", "Large Multi-Family (7+ units)", "mixed_studio_to_3", 300,
  "Neighborhood Infill", "Condo", "beds_1", 200
)

# Calculate revenue for Lake View scenarios
lakeview_results <- lakeview_scenarios %>%
  left_join(tax_rates, by = c("property_type", "bedroom_type")) %>%
  mutate(tax_revenue = units * avg_tax_per_unit)

# Summarize Lake View scenario results
lakeview_summary <- lakeview_results %>%
  group_by(scenario_name) %>%
  summarize(
    total_units = sum(units),
    total_revenue = sum(tax_revenue),
    revenue_per_unit = total_revenue / total_units,
    .groups = 'drop'
  )

# Display Lake View summary table
kable(lakeview_summary %>%
  mutate(
    total_units = format_number(total_units),
    total_revenue = format_currency(total_revenue),
    revenue_per_unit = format_currency(revenue_per_unit)
  ),
  col.names = c("Scenario", "Total Units", "Annual Tax Revenue", "Revenue per Unit"),
  caption = "Projected Annual Tax Revenue by Development Scenario in Lake View")

# Create visualization for Lake View scenarios
lakeview_plot <- lakeview_results %>%
  group_by(scenario_name, property_type) %>%
  summarize(tax_revenue = sum(tax_revenue), .groups = 'drop') %>%
  ggplot(aes(x = scenario_name, 
             y = tax_revenue/1e6, 
             fill = property_type)) +
  geom_bar(stat = "identity", position = "stack") +
  geom_text(aes(label = scales::dollar(tax_revenue/1e6, accuracy = 0.1, suffix = "M")),
            position = position_stack(vjust = 0.5),
            color = "white",
            size = 3) +
  scale_y_continuous(labels = scales::dollar_format(suffix = "M"),
                    expand = expansion(mult = c(0, 0.1))) +
  scale_fill_manual(values = modern_palette) +
  labs(
    title = "Projected Annual Tax Revenue by Development Scenario in Lake View",
    subtitle = "Broken down by property type, with revenue amounts shown in millions",
    x = "Development Scenario",
    y = "Tax Revenue (Millions)",
    fill = "Property Type"
  ) +
  theme_minimal() +
  theme(
    plot.title = element_text(face = "bold", size = 14),
    plot.subtitle = element_text(size = 10, color = "gray50"),
    axis.title = element_text(face = "bold"),
    axis.text.x = element_text(angle = 45, hjust = 1),
    legend.position = "bottom",
    legend.box = "horizontal",
    panel.grid.major.x = element_blank()
  )

lakeview_plot
```

### Lake View Scenario Details

1. **Transit Corridor Development** (3,000 total units)
   - Focuses on high-density development along major transit routes
   - Emphasizes larger multi-family buildings (1,500 units) near transit stops
   - Includes a mix of 1-bed (800 units) and 2-bed (500 units) condos
   - Limited small multi-family (200 units) as buffer zones
   - Projected annual revenue: `r format_currency(lakeview_summary$total_revenue[1])`

2. **Mixed-Income Development** (2,200 total units)
   - Balanced approach with diverse housing types
   - Large multi-family component (1,000 units) for affordable options
   - Mix of small multi-family (500 units) throughout
   - Even distribution of 1-bed (400 units) and 2-bed (300 units) condos
   - Projected annual revenue: `r format_currency(lakeview_summary$total_revenue[2])`

3. **Neighborhood Infill** (1,700 total units)
   - Emphasizes smaller-scale development compatible with existing neighborhoods
   - Focus on small multi-family buildings (800 units)
   - More 2-bed (400 units) than 1-bed (200 units) condos
   - Limited large multi-family (300 units) at strategic locations
   - Projected annual revenue: `r format_currency(lakeview_summary$total_revenue[3])`

### Lake View Development Insights

1. **Revenue Generation**:
   - Transit Corridor scenario generates the highest total revenue at `r format_currency(lakeview_summary$total_revenue[1])` annually
   - Mixed-Income approach provides balanced revenue of `r format_currency(lakeview_summary$total_revenue[2])` annually
   - Neighborhood Infill generates `r format_currency(lakeview_summary$total_revenue[3])` while maintaining neighborhood character

2. **Unit Mix Considerations**:
   - Large multi-family developments contribute significantly to total revenue
   - Condo units provide strong per-unit revenue
   - Small multi-family buildings offer good revenue while preserving neighborhood scale

3. **Location Strategy**:
   - Focus high-density development along major transit corridors
   - Distribute small multi-family units throughout neighborhoods
   - Strategic placement of larger developments near existing amenities

4. **Implementation Recommendations**:
   - Phase development starting with transit-adjacent parcels
   - Coordinate with CTA on transit-oriented development
   - Implement design guidelines to ensure compatibility with existing buildings
   - Consider TIF districts for infrastructure improvements

## Methodology Notes

This analysis uses actual property tax data from Cook County for 2021-2022. Key assumptions include:

- Tax rates remain consistent with 2022 levels
- New developments achieve similar values to existing properties
- Unit counts for multi-family properties are estimated based on property values
- Scenarios represent theoretical development patterns

Data sources:
- Cook County Assessor's Office
- Property tax bills from 2021-2022
- Township-level assessment data

Note on Effective Tax Rates: The effective tax rate is calculated as the ratio of total tax to market value. In cases where this calculation initially resulted in NA values (due to missing or zero market values), we've computed it using the average tax per unit divided by average value per unit to ensure completeness of the analysis.
